#!/bin/bash
# curl -i -H "Content-Type: application/json" -d '[{}]' http://apm:8200/intake/v2/events
# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"bfae486859461976c58a157d8c487b0352b75212e5fc55ef08d366297f3a140b"},"hostname":"bfae48685946","platform":"linux"},"process":{"pid":1225,"argv":["/tmp/go-build933738224/b001/exe/main"],"ppid":1170,"title":"main"},"service":{"agent":{"name":"go","version":"1.3.0"},"language":{"name":"go","version":"go1.12"},"name":"transporttest","runtime":{"name":"gc","version":"go1.12"}}}}\n{"transaction":{"duration":0.045399999999999996,"id":"1775d1f296228739","name":"GET /mycurl3","span_count":{"dropped":0,"started":0},"timestamp":1560322663000000,"trace_id":"1775d1f2962287397d006d772707db97","type":"request","context":{"tags":{"region":"us-east-1"}},"result":"Success"}}' http://apm:8200/intake/v2/events
# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"bfae486859461976c58a157d8c487b0352b75212e5fc55ef08d366297f3a140b"},"hostname":"test.com","platform":"linux"},"process":{"pid":1225,"argv":["/tmp/go-build933738224/b001/exe/main"],"ppid":1170,"title":"main"},"service":{"agent":{"name":"php","version":"1.3.0"},"language":{"name":"php","version":"php7.2"},"name":"transporttest","runtime":{"name":"gc","version":"php7.2"}}}}\n{"transaction":{"duration":0.045399999999999996,"id":"1775d1f296228739","name":"GET /mycurl","span_count":{"dropped":0,"started":0},"timestamp":1559990475366367,"trace_id":"1775d1f2962287397d006d772707db97","type":"request","context":{"tags":{"region":"us-east-1"}},"result":"Success"}}' http://apm:8200/intake/v2/events
# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"bfae486859461976c58a157d8c487b0352b75212e5fc55ef08d366297f3a140b"},"hostname":"test1.com","platform":"linux"},"process":{"pid":1225,"argv":["/tmp/go-build933738224/b001/exe/main"],"ppid":1170,"title":"main"},"service":{"agent":{"name":"php","version":"1.3.0"},"language":{"name":"php","version":"php7.2"},"name":"transporttest","runtime":{"name":"gc","version":"php7.2"}}}}\n{"transaction":{"duration":0.1,"id":"1775d1f296228739","name":"GET /mycurl","span_count":{"dropped":0,"started":0},"timestamp":1559990475366367,"trace_id":"1775d1f2962287397d006d772707db97","type":"request","context":{"tags":{"region":"us-east-1"}},"result":"Success"}}' http://apm:8200/intake/v2/events



# {"metadata":{"system":{"architecture":"amd64","container":{"id":"baaa6d13af2bd60562f7915478a270a50acf5d19a24b8432d588b620b50f0c72"},"hostname":"baaa6d13af2b","platform":"linux"},"process":{"pid":669,"argv":["/tmp/go-build645211124/b001/exe/main"],"ppid":614,"title":"main"},"service":{"agent":{"name":"go","version":"1.3.0"},"language":{"name":"go","version":"go1.12"},"name":"transporttest","runtime":{"name":"gc","version":"go1.12"}}}}
# {"span":{"duration":0.1189,"id":"b462f487a50d9163","name":"SELECT FROM foo1","timestamp":1560354008984069,"trace_id":"3177448ca90cda29a43ce7a2b4f47809","transaction_id":"3177448ca90cda29","type":"db","action":"query","parent_id":"3177448ca90cda29","subtype":"mysql"}}
# {"transaction":{"duration":0.1738,"id":"3177448ca90cda29","name":"GET /myapi","span_count":{"dropped":0,"started":1},"timestamp":1560354008984026,"trace_id":"3177448ca90cda29a43ce7a2b4f47809","type":"request","context":{"tags":{"region":"us-east-1"}},"result":"Success"}}

timestamp=`date "+%s"000000`
echo $timestamp
transaction_id=`echo -n "${timestamp}" | md5sum |cut -c 1-32`
trace_id=${transaction_id}
transaction_id=`echo ${transaction_id}|cut -c 1-16`
span_id=`echo -n "${timestamp}$RANDOM" | md5sum |cut -c 1-16`
echo $trace_id
echo $transaction_id
echo $span_id
# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"bfae486859461976c58a157d8c487b0352b75212e5fc55ef08d366297f3a140b"},"hostname":"bfae48685946","platform":"linux"},"process":{"pid":1225,"argv":["/tmp/go-build933738224/b001/exe/main"],"ppid":1170,"title":"main"},"service":{"agent":{"name":"go","version":"1.3.0"},"language":{"name":"go","version":"go1.12"},"name":"transporttest","runtime":{"name":"gc","version":"go1.12"}}}}\n{"transaction":{"duration":1000.045399999999999996,"id":"'"${transaction_shortid}"'","name":"GET /mycurl2","span_count":{"dropped":0,"started":1},"timestamp":'"${timestamp}"',"trace_id":"'"${trace_id}"'","type":"request","context":{"tags":{"region":"us-east-1"}},"result":"Success"}}' http://apm:8200/intake/v2/events
# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"aaa"},"hostname":"test2.com","platform":"linux"},"process":{"pid":1225,"ppid":1170,"title":"main"},"service":{"agent":{"name":"php","version":"1.3.0"},"language":{"name":"php","version":"php7.2"},"name":"transporttest2","runtime":{"name":"gc","version":"php7.2"}}}}\n{"span":{"id":"'${span_id}'","name":"GET /mycurl2-rpc1","start":'${timestamp}',"duration":100,"timestamp":'"${timestamp}"',"type":"request","transaction_id":"'"${transaction_id}"'","parent_id":"'"${transaction_id}"'","trace_id":"'"${trace_id}"'"}}' http://apm:8200/intake/v2/events
# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"bfae486859461976c58a157d8c487b0352b75212e5fc55ef08d366297f3a140b"},"hostname":"bfae48685946","platform":"linux"},"process":{"pid":1225,"argv":["/tmp/go-build933738224/b001/exe/main"],"ppid":1170,"title":"main"},"service":{"agent":{"name":"go","version":"1.3.0"},"language":{"name":"go","version":"go1.12"},"name":"transporttest","runtime":{"name":"gc","version":"go1.12"}}}}\n{"span":{"id":"'${span_id}'","name":"GET /mycurl2-rpc1","start":'${timestamp}',"duration":100,"timestamp":'"${timestamp}"',"type":"request","transaction_id":"'"${transaction_id}"'","parent_id":"'"${transaction_id}"'","trace_id":"'"${trace_id}"'"}}\n{"transaction":{"duration":1000.045399999999999996,"id":"'"${transaction_id}"'","name":"GET /mycurl2","span_count":{"dropped":0,"started":1},"timestamp":'"${timestamp}"',"trace_id":"'"${trace_id}"'","type":"request","context":{"tags":{"region":"us-east-1"}},"result":"Success"}}' http://apm:8200/intake/v2/events
# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"aaa"},"hostname":"test2.com","platform":"linux"},"process":{"pid":1225,"ppid":1170,"title":"main"},"service":{"agent":{"name":"php","version":"1.3.0"},"language":{"name":"php","version":"php7.2"},"name":"transporttest2","runtime":{"name":"gc","version":"php7.2"}}}}\n{"span":{"id":"'${span_id}'","name":"GET /mycurl2-rpc1","start":'${timestamp}',"duration":100,"timestamp":'"${timestamp}"',"type":"request","transaction_id":"'"${transaction_id}"'","parent_id":"'"${transaction_id}"'","trace_id":"'"${trace_id}"'"}}' http://apm:8200/intake/v2/events


# curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"baaa6d13af2bd60562f7915478a270a50acf5d19a24b8432d588b620b50f0c72"},"hostname":"baaa6d13af2b","platform":"linux"},"process":{"pid":669,"argv":["/tmp/go-build645211124/b001/exe/main"],"ppid":614,"title":"main"},"service":{"agent":{"name":"go","version":"1.3.0"},"language":{"name":"go","version":"go1.12"},"name":"transporttest","runtime":{"name":"gc","version":"go1.12"}}}}\n{"span":{"duration":0.1189,"id":"b462f487a50d9163","name":"SELECT FROM foo1","timestamp":1560354008984069,"trace_id":"3177448ca90cda29a43ce7a2b4f47809","transaction_id":"3177448ca90cda29","type":"db","action":"query","parent_id":"3177448ca90cda29","subtype":"mysql"}}\n{"transaction":{"duration":0.1738,"id":"3177448ca90cda29","name":"GET /myapi3","span_count":{"dropped":0,"started":1},"timestamp":1560354008984026,"trace_id":"3177448ca90cda29a43ce7a2b4f47809","type":"request","context":{"tags":{"region":"us-east-1"}},"result":"Success"}}' http://apm:8200/intake/v2/events
curl -i -H "Content-Type: application/x-ndjson" -d $'{"metadata":{"system":{"architecture":"amd64","container":{"id":"baaa6d13af2bd60562f7915478a270a50acf5d19a24b8432d588b620b50f0c72"},"hostname":"baaa6d13af2b","platform":"linux"},"process":{"pid":669,"argv":["/tmp/go-build645211124/b001/exe/main"],"ppid":614,"title":"main"},"service":{"agent":{"name":"go","version":"1.3.0"},"language":{"name":"go","version":"go1.12"},"name":"transporttest","runtime":{"name":"gc","version":"go1.12"}}}}\n{"span":{"duration":0.1189,"id":"b462f487a50d9163","name":"SELECT FROM foo3","timestamp":1560354008984069,"trace_id":"3177448ca90cda29a43ce7a2b4f47809","transaction_id":"3177448ca90cda29","type":"db","action":"query","parent_id":"3177448ca90cda29","subtype":"mysql"}}' http://apm:8200/intake/v2/events